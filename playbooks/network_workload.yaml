---
- name: Network Intensive Workload
  hosts: "{{ target_group | default('targets_1') }}"
  gather_facts: false
  serial: 1
  
  tasks:
    - name: Multiple concurrent DNS resolutions
      shell: |
        domains=(google.com github.com ubuntu.com stackoverflow.com example.com docker.com python.org ansible.com)
        for domain in "\${domains[@]}"; do
          nslookup "$domain" > /dev/null 2>&1 &
        done
        wait
        echo "Resolved \${#domains[@]} domains concurrently"
      register: dns_results
      
    - name: Network latency testing
      shell: |
        ping -c 3 8.8.8.8 | grep 'min/avg/max'
      register: ping_result
      
    - name: Multiple SSH connections (local loopback)
      shell: |
        for i in {1..3}; do
          ssh -o ConnectTimeout=2 -o StrictHostKeyChecking=no localhost "echo 'SSH test $i'" > /dev/null 2>&1 &
        done
        wait
        echo "Completed multiple SSH connections"
      ignore_errors: yes
      
    - name: Network service checks
      wait_for:
        host: "{{ item.host }}"
        port: "{{ item.port }}"
        timeout: 5
      loop:
        - { host: "10.0.100.1", port: "22" }
        - { host: "8.8.8.8", port: "53" }
      ignore_errors: yes
